import{j as e,d as oe,u as Y,r as n,e as ae,f as U,_ as k,h as D,i as ie,l as le,k as ce,m as me,n as de,o as ue,p as fe,q as ge,t as pe,S as N,g as he,T as xe,I as je,v as ye,w as B,x as $,N as O,A as ve}from"./index-1chCkVik.js";import{M as Me,a as Se}from"./Menu-BaTIauzb.js";import{M as L,L as w}from"./MenuItem-CMl7zzIZ.js";import{T as V}from"./Tooltip-DnVxIlfV.js";import{c as A,T as E}from"./Typography-gYzn-N8Q.js";import{b as Ae}from"./index-BTGpsw6g.js";import{m as Fe,A as be}from"./AppLayout-CDYdPiqI.js";import{R as ke}from"./RenderAttachment-CCUylxti.js";import{B as P,u as Ce,a as Te}from"./Menu-PGS1KhgP.js";import{A as Le}from"./Avatar-BdPrWYVU.js";import{I as G}from"./IconButton-BinniJZF.js";import"./Modal-hu0AyHgC.js";import"./Toolbar-CRnfIr8i.js";import"./ExitToApp-CVG3SFKD.js";import"./Delete-CZiADT_9.js";import"./AvatarCard-50N8nPtQ.js";import"./Notifications-pJh6Go0y.js";const we=A(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),Ve=A(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 11h-3v3.75c0 1.24-1.01 2.25-2.25 2.25S8.5 17.99 8.5 16.75s1.01-2.25 2.25-2.25c.46 0 .89.14 1.25.38V11h4zm-3-4V3.5L18.5 9z"}),"AudioFile"),Ee=A(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),Ie=A(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),Re=A(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),He=A(e.jsx("path",{d:"M14 2H6.01c-1.1 0-2 .89-2 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-1 7V3.5L18.5 9zm1 5 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFile"),ze=({anchorE1:s,chatId:i})=>{const{isFileMenu:o}=oe(t=>t.misc),l=Y(),d=n.useRef(null),h=n.useRef(null),a=n.useRef(null),u=n.useRef(null),[f]=ae(),g=()=>l(U(!1)),x=()=>{var t;return(t=d.current)==null?void 0:t.click()},c=()=>{var t;return(t=h.current)==null?void 0:t.click()},j=()=>{var t;return(t=a.current)==null?void 0:t.click()},C=()=>{var t;return(t=u.current)==null?void 0:t.click()},y=async(t,v)=>{const M=Array.from(t.target.files);if(M.length<=0)return;if(M.length>7)return k.error(`You can only send 7 ${v} at a time (Thala for a Reason)`);l(D(!0));const F=k.loading(`Sending ${v}...`);g();try{const p=new FormData;p.append("chatId",i),M.forEach(S=>p.append("files",S)),(await f(p)).data?k.success(`${v} sent successfully`,{id:F}):k.error(`Failed to send ${v}`,{id:F})}catch(p){k.error(p,{id:F})}finally{l(D(!1))}};return e.jsx(Me,{anchorEl:s,open:o,onClose:g,children:e.jsx("div",{style:{width:"10rem"},children:e.jsxs(Se,{children:[e.jsxs(L,{onClick:x,children:[e.jsx(V,{title:"Image",children:e.jsx(Ee,{})}),e.jsx(w,{style:{marginLeft:"0.5rem"},children:"Image"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/png, image/jpeg, image/gif",style:{display:"none"},onChange:t=>y(t,"Images"),ref:d})]}),e.jsxs(L,{onClick:c,children:[e.jsx(V,{title:"Audio",children:e.jsx(Ve,{})}),e.jsx(w,{style:{marginLeft:"0.5rem"},children:"Audio"}),e.jsx("input",{type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:t=>y(t,"Audios"),ref:h})]}),e.jsxs(L,{onClick:j,children:[e.jsx(V,{title:"Video",children:e.jsx(He,{})}),e.jsx(w,{style:{marginLeft:"0.5rem"},children:"Video"}),e.jsx("input",{type:"file",multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:t=>y(t,"Videos"),ref:a})]}),e.jsxs(L,{onClick:C,children:[e.jsx(V,{title:"File",children:e.jsx(Re,{})}),e.jsx(w,{style:{marginLeft:"0.5rem"},children:"File"}),e.jsx("input",{type:"file",multiple:!0,accept:"*",style:{display:"none"},onChange:t=>y(t,"Files"),ref:u})]})]})})})},_e=({message:s,user:i})=>{var f;const{sender:o,content:l,attachments:d=[],createdAt:h}=s,a=(o==null?void 0:o.id)===(i==null?void 0:i._id)||(o==null?void 0:o._id)===(i==null?void 0:i._id),u=ie(h).fromNow();return e.jsxs(Fe.div,{initial:{opacity:0,x:a?"100%":"-100%"},animate:{opacity:1,x:0},whileInView:{opacity:1,x:0},style:{alignSelf:a?"flex-end":"flex-start",backgroundColor:a?"#DCF8C6":"#FFFFFF",color:"black",borderRadius:"10px",padding:"0.5rem",width:"fit-content",maxWidth:"60%",display:"flex",flexDirection:"column",alignItems:a?"flex-end":"flex-start",marginBottom:"0.5rem"},children:[e.jsxs(P,{display:"flex",flexDirection:a?"row-reverse":"row",alignItems:"center",mb:1,children:[e.jsx(Le,{src:(f=o==null?void 0:o.avatar)==null?void 0:f.url}),!a&&e.jsx(E,{color:le,fontWeight:"600",variant:"caption",ml:1,children:o.name})]}),l&&e.jsx(E,{style:{textAlign:a?"right":"left",alignSelf:a?"flex-end":"flex-start"},children:l}),d.length>0&&d.map((g,x)=>{const c=g.url,j=ce(c);return e.jsx(P,{mt:1,style:{alignSelf:a?"flex-end":"flex-start"},children:e.jsx("a",{href:c,target:"_blank",download:!0,style:{color:"black"},children:ke(j,c)})},x)}),e.jsx(E,{variant:"caption",color:"text.secondary",style:{alignSelf:a?"flex-end":"flex-start"},children:u})]})},De=n.memo(_e),Ne=({chatId:s,user:i})=>{var R,H,z,_;const o=me(),l=Y(),d=de(),h=n.useRef(null),a=n.useRef(null),u=n.useRef(null),[f,g]=n.useState(""),[x,c]=n.useState([]),[j,C]=n.useState(1),[y,t]=n.useState(null),[v,M]=n.useState(!1),[F,p]=n.useState(!1),m=ue({chatId:s,skip:!s}),S=fe({chatId:s,page:j}),{data:W,setData:I}=Ae(h,(R=S.data)==null?void 0:R.totalPages,j,C,(H=S.data)==null?void 0:H.messages),Q=[{isError:m.isError,error:m.error},{isError:S.isError,error:S.error}],T=(_=(z=m==null?void 0:m.data)==null?void 0:z.chat)==null?void 0:_.members,q=r=>{g(r.target.value),v||(o.emit(B,{members:T,chatId:s}),M(!0)),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{o.emit($,{members:T,chatId:s}),M(!1)},[2007])},X=r=>{l(U(!0)),t(r.currentTarget)},J=r=>{r.preventDefault(),f.trim()&&(o.emit(O,{chatId:s,members:T,message:f}),g(""))};n.useEffect(()=>(l(ge(s)),()=>{c([]),g(""),I([]),C(1)}),[s,l,T,I,o,i._id]),n.useEffect(()=>{a.current&&a.current.scrollIntoView({behavior:"smooth"})},[x]),n.useEffect(()=>{if(m.isError)return d("/")},[m.isError,d]);const K=n.useCallback(r=>{r.chatId===s&&c(b=>[...b,r.message])},[s]),Z=n.useCallback(r=>{r.chatId==s&&p(!0)},[s]),ee=n.useCallback(r=>{r.chatId==s&&p(!1)},[s]),te=n.useCallback(r=>{if(r.chatId!==s)return;const b={content:r.message,sender:{_id:"bklgandubsdktmkcstfu",name:"Admin"},chat:s,createdAt:new Date().toISOString()};c(re=>[...re,b])},[s]),se={[O]:K,[B]:Z,[$]:ee,[ve]:te};Ce(o,se),Te(Q);const ne=[...W,...x].sort((r,b)=>new Date(r.createdAt)-new Date(b.createdAt));return m.isLoading?e.jsx(pe,{}):e.jsxs(n.Fragment,{children:[e.jsxs(N,{ref:h,boxSizing:"border-box",padding:"1rem",spacing:"1rem",bgcolor:he,height:"90%",sx:{overflowX:"hidden",overflowY:"auto"},children:[ne.map(r=>e.jsx(De,{message:r,user:i},r._id)),F&&e.jsx(xe,{}),e.jsx("div",{ref:a})]}),e.jsx("form",{style:{height:"10%"},onSubmit:J,children:e.jsxs(N,{direction:"row",height:"100%",padding:"1rem",alignItems:"center",position:"relative",children:[e.jsx(G,{sx:{position:"absolute",left:"1.5rem",rotate:"30deg"},onClick:X,children:e.jsx(we,{})}),e.jsx(je,{placeholder:"Type Message Here...",value:f,onChange:q}),e.jsx(G,{type:"submit",sx:{rotate:"-10deg",bgcolor:ye,color:"white",marginLeft:"1rem",padding:"0.5rem","&:hover":{bgcolor:"error.dark"}},children:e.jsx(Ie,{})})]})}),e.jsx(ze,{anchorE1:y,chatId:s})]})},nt=be()(Ne);export{nt as default};
